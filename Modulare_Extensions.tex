\section{Modulare Extensions}\label{Modulare Extensions}
Im im Folgenden soll evaluiert werden in wie weit es möglich ist, dass verschiedene Extensions zusammen arbeiten können.
Das Supportportal im Ganzen soll aus verschiedenen Extensions bestehen, welche modular auf einander aufbauen. 

Es sollen folgende Extensions erstellt werden:

\FloatBarrier
\begin{minipage}{3cm}
\textit{Template}
\end{minipage}
\begin{minipage}{13cm}
In der \textit{Template} Extension wird das grundlegende Layout des Supportportals definiert.\\
Zusätzlich kommen noch einige ViewHelper und Utility-Funktion hinzu, welche von mehreren anderen Extensions genutzt werden können.\\
Alle anderen Extensions bauen auf dieser auf und sind ohne diese nicht Lauffähig.\\
\end{minipage}

\begin{minipage}{3cm}
\textit{SupportBase}
\end{minipage}
\begin{minipage}{13cm}
Die Extension \textit{SupportBase} stellt das grundlegende Datenmodell zur Verfügung, das andere Extensions nutzen und auch erweitern können.\\
Zusätzlich kümmert sich diese Extension auch um das Login der Nutzer. Dies schließt die Neuanmeldung und das Ändern des Passwortes mit ein.\\
\end{minipage}

\begin{minipage}{3cm}
\textit{Polymer}
\end{minipage}
\begin{minipage}{13cm}
Die \textit{Polymer}-Extension stellt \textit{Polymer}-Elemente (siehe Abschnitt \ref{Typo und Polymer}) in Form von ViewHelpern (siehe Abschnitt \ref{Fluid}) zur Verfügung. Sie bildet eine Sammlung von \textit{Polymer}-Elementen, welche andere Extensions verwenden können.\\
Alle Extensions, welche \textit{Polymer}-Elemente verwenden, sind von ihr abhängig.\\
\end{minipage}

\begin{minipage}{3cm}
\textit{DownloadPortal}
\end{minipage}
\begin{minipage}{13cm}
Die Extension erweitert das Datenmodell der \textit{SupportBase} und stellt für die Nutzer von PDV-Produkten wichtige Downloads bereit.\\
Zusätzlich bietet sie eine Abo-Funkion an, in der Nutzer sich für bestimmte Download-Kategorien anmelden können. Bei neuen Downloads werden sie dann entsprechend benachrichtigt.\\
\end{minipage}

\begin{minipage}{3cm}
\textit{SupportPortal}
\end{minipage}
\begin{minipage}{13cm}
Die \textit{SupportPortal}-Extension ist das Herzstück des allumfassenden Supportportals. Mit ihr ist es möglich Calls zu Problemen oder Software-Bugs zu öffenen und mit Supportmitarbeitern in Kontakt zu treten.\\
\end{minipage}

\begin{minipage}{3cm}
\textit{KnowledgeBase}
\end{minipage}
\begin{minipage}{13cm}
Die \textit{KnowledgeBase} ist, wie der Name schon sagt, ein Verzeichnis mit bekannten Problemen und Hinweisen zum verwenden der PDV-Software. Sie bezieht sich auf Daten aus der \textit{SupportBase}.\\
\end{minipage}

\begin{minipage}{3cm}
\textit{DataExchange}
\end{minipage}
\begin{minipage}{13cm}
Um den Datenaustaus zwischen Kunden zu gewährleisten, soll die Extension \textit{DataExchange} geschaffen werden. Über sie ist es möglich, dass PDV-Mitarbeiter Kunden Daten zur Verfügung stellen und umgekehrt.\\
\end{minipage}

\begin{minipage}{3cm}
\textit{AdminSchulung}
\end{minipage}
\begin{minipage}{13cm}
Die \textit{AdminSchulung} ist eine Extension, welche es der PDV Systeme GmbH erlaubt Schulungen und Prüfungen für Systemadministratoren online durchführen zu können.\\
\end{minipage}

Die Extensions \textit{Template}, \textit{SupportBase} und \textit{Polymer} stellen grundlegende Extensions dar, von denen alle Support-Extensions abhängig sind. Die Support-Extensions \textit{DownloadPortal}, \textit{SupportPortal}, \textit{KnowledgeBase}, \textit{DataExchange} und \textit{AdminSchulung} sind alle voneinander unabhänig und können modular eingesetzt werden.

Innerhalb der vorliegenden Arbeit sollen nicht alle Extensions programmiert werden, da dies aus Gründen des Aufwandes nicht möglich ist. Es soll lediglich Anhand der Extensions \textit{Template}, \textit{Polymer}, \textit{SupportBase} und \textit{DownloadPortal} gezeigt werden, dass modulare Extensions unter Typo3 möglich sind und wie ein Lösungsansatz aussehen kann.

Im weiteren Verlauf wird ebenso auf die genaue Programmierung der einzelnen Extensions verzichtet. Es wird sich auf die Schwerpunkte bezogen, welche wichtig sind um die Extensions modular aufzubauen und wie es möglich ist, moderne Web-Technologien wie \textit{Polymer} oder AngularJS in Typo3 Extensions einzubauen (siehe Kapitel \ref{Zusammenspiel der Technologien}).

\subsection{Datenbasis}
Im Verlauf der Arbeit wurde schon erwähnt, dass die verschiedenen Extensions modular aufgebaut werden sollen. Hierfür muss natürlich auch eine grundlegende Datenbasis geschaffen werden. Diese Basis stellt die Extension \textit{Support Base} zur Verfügung. In Abbildung \ref{data_support_base} ist die Datenbasis einmal grafisch dargestellt.

\begin{figure}[!ht]
\centering
\includegraphics[width=16cm]{Bilder/datenmodel_supportbase.png}
\caption{Datenbasis der \textit{Support Base} Extension}
\label{data_support_base}
\centering
\end{figure}

Die Datenbasis besteht insgesamt aus neun Klassen, wobei die Klassen \textit{TempUser}, \textit{User}, \textit{PushInformation} und \textit{Company} die Frontend-Nutzer abbilden. \textit{Projekt}, \textit{AddOn}, \textit{ProductGroup}, \textit{Product} und \textit{ProductDependences} stellen die Datenbasis für Produktentwicklungen der PDV Systeme GmbH dar.

\textit{TempUser} ist eine Hilfsklasse, welche innerhalb der Registrierung verwendet wird. Solange der Nutzer nicht freigegeben ist, sind seine Daten als "`TempUser"' gespeichert. Sobald er Freigegeben wurde, werden die entsprechenden Daten zu einer Instanz der Klasse \textit{User} ungewandelt und gespeichert. Ein "`User"' gehört einem Unternehmen an und kann zusätzlich auch Stellvertetungen (\textit{substitue}) für andere Firmen übernehmen. Zusätzlich werden für einen "`User"' auch Informationen gespeichert, welche für die Übertragung der Push-Nachrichten benötigt werden (\textit{PushInformation}).

Produkte (\textit{Product}) innerhalb der PDV werden für Mandanten erstellt, welche innerhalb eines Projekts (\textit{Project}) teilnehmen. Innerhalb eines Projekts können mehrere Firmen als Mandanten angegeben werden. Produkte wiederum sind in Produktgruppen (\textit{ProductGroup}) angeordnet und können verschiedene Abhängigkeiten (\textit{ProductDependences}) haben.

Zusätzlich zum eigentlichen Produkt, können Projekte auch "`AddOns"' (\textit{AddOn}) enthalten, welche ein Produkt erweitern.

Die Klasse \textit{User} erbt von der TYPO3 eigenen Klasse \textit{FrontendUser}. Diese Erweiterung muss innerhalb der Extensionkonfiguration \texttt{Configuration/TCA/Overrides} angegeben werden. TYPO3 erweitert bei der Installation der Extension dann die Datenbanktabelle der "`FrontendUser"' um die entsprechenden Felder.

Das Datenmodell der \textit{Downloads} Extension wiederum ist in Abbildung \ref{data_downloads} zu sehen und erweitert das Datenmodell der \textit{Support Base}.

\begin{figure}[!ht]
\centering
\includegraphics[width=13cm]{Bilder/datenmodell_Download_Portal_2.png}
\caption{Datenbasis der \textit{Downloads} Extension}
\label{data_downloads}
\centering
\end{figure}

Die \textit{Downloads} Extension beinhaltet die Klassen \textit{DownloadUser}, \textit{DownloadItem}, \textit{Category}, \textit{SubCategory}, \textit{Type} und \textit{SubType}. Die Klasse \textit{Company} gehört zur \textit{Support Base} Extension und wurde hier nur zur Veranschaulichung hinzugefügt.

\textit{DownloadUser} erweitert die Klasse \textit{User} der \textit{Support Base} Extension und fügt ihr weitere Attribute hinzu. Ein "`DownloadItem"' kann in verschiedene Kategorien (\textit{Category}) und Unterkategorien (\textit{SubCategory}) eingeordnet sein. Zusätzlich enthält ein "`DownloadItem"', zur besseren Gliederung noch einen Typ (\textit{Type}) und einen Untertyp (SubType).

Um nachzuverfolgen zu können, welche Downloads von Nutzer und Firmen, getätigt wurden, werden hier zusätzliche Informationen gespeichert. Es kann nachverfolgt werden, welcher Nutzer welches "`DownloadItem"' geladen hat. Zusätzlich wird ein Vermerk an das "`DownloadItem"' angefügt um nachvollziehen zu können, welche Firmen den Download bezogen haben. 
Diese Informationen werden von Supportmitarbeitern benötigt, um möglichst schnell sehen zu können, ob eine Firma schon die neusten Änderungen der Software bezogen hat.

Weitere Extensions, welche zur Zeit noch nicht existieren, sollen dieses Prinzip der modularen Datenhaltung weiterverfolgen.

\subsection{Rendering}\label{Rendering}
Im folgenden Abschnitt soll dargestellt werden, wie es unter TYPO3 möglich ist ein modulares Rendering aufzubauen. 
Dies geschieht am Beispiel der oberen Menüleiste des des Templates.

\begin{figure}[!ht]
\centering
\includegraphics[width=16cm]{Bilder/nav_bar.png}
\caption{Navigationsleiste wenn Nutzer ein nicht eingeloggt ist}
\label{Nav_Logout}
\centering
\end{figure}

Die \textit{Template}-Extension stellt die grundlegende Menüleiste siehe Abbildung \ref{Nav_Logout} dar.
Um die oben beschrieben Problematik zu lösen, wurde ein ViewHelper entwickelt, welcher innerhalb der Menüleiste eingebunden werden kann.

Ohne eine Extension, welche das Login bereitstellt (\textit{SupportBase}), kann die \textit{Template}-Extension also keinen Login darstellen.
Alle Elemente wie zum Beispiel Buttons, welche modale Dialoge zum Einloggen triggern, müssen also beim Rendern vom Template gesucht und eingebunden werden. Dies betrifft natürlich auch die modalen Dialoge selbst.

Um das eben beschriebene Problemen zu lösen, wurde ein \textit{ViewHelper} entwickelt, welcher innerhalb der Menüleiste eingebunden werden kann.
Wird nun das Template mit der Menüleiste gerendert, wird der \textit{ViewHelper} aufgerufen, welcher die entsprechend Elemente in die Menüleiste rendert.

Der \textit{ViewHelper} muss nun alle installierten Extensions nach Elementen durchsuchen, welche innerhalb der Menüleiste gerendert werden sollen. Hierbei muss natürlich darauf geachtet werden, dass es in der Menüleiste drei Arten von Elementen gibt. 

\begin{itemize}
 \item Elemente, die immer geladen werden müssen.
 \item Elemente, die angezeigt werden, wenn der Nutzer eingeloggt ist.
 \item Elemente, die angezeigt werden, wenn der Nutzer nicht eingeloggt ist.
\end{itemize}

Damit die entsprechenden Elemente gefunden und im passenden Fall geladen werden, wurden drei Annotationen geschaffen, mit denen die entsprechenden HTML-Dateien beginnen müssen.

\begin{itemize}
 \item \texttt{@additionHTML}
 \item \texttt{@authenticated}
 \item \texttt{@notAuthenticated}
\end{itemize}

Um die Suche nach entsprechenden HTML-Dateien zu beschleunigen, wurde festgelegt, dass Elemente nur in Extensions gesucht werden, welche mit "`pdv"' beginnen. Somit durchsucht der ViewHelper nur PDV eigene Extensions, welche nach der Konvention mit "`pdv"' beginnen. Damit die Suche noch schneller von statten geht, wurde außerdem festgelegt, dass Elemente innerhalb eines festgelegten Pfades zu finden sind. Konkret bedeutet das, dass Elemente innerhalb von Extensions im Pfad \texttt{Resources/Private/NavBar} abgelegt werden müssen.

\newpage
Damit der \textit{ViewHelper} die entsprechenden Element-Arten an den richtigen Stellen einbringt, kann dieser mit Hilfe des Attributs \textit{section} gesteuert werden.

\begin{itemize}
 \item \texttt{add}
 \item \texttt{Auth}
 \item \texttt{noAuth}
\end{itemize}

\lstinputlisting[language=html, caption=ViewHelper-Aufruf, label=NavViewHelper, captionpos=b]{Code/nav_helper.html}

Im Codebeispiel \ref{NavViewHelper} wird der Aufruf des \textit{ViewHelpers} schematisch dargestellt. Über den \textit{Standard-ViewHelper} \texttt{ifAuthenticated} geprüft, ob der Nutzer angemeldet ist. Ist dies der Fall, wird wiederum der eben beschriebene \texttt{NavBarViewHelper} mit dem Attribut \texttt{section="\ Auth"} aufgerufen. Somit sucht der \textit{ViewHelper} beim Rendern nun nach allen Elementen, die angezeigt werden müssen, wenn ein Nutzer angemeldet ist.

\begin{figure}[!ht]
\centering
\includegraphics[width=16cm]{Bilder/NavBar.eps}
\caption{Darstellung des NavBarViewHelper}
\label{NavBarViewHelper}
\centering
\end{figure}

In Abbildung \ref{NavBarViewHelper} ist die Funkion des \texttt{NavBarViewHelper} noch einmal schematisch dargestellt. Der \textit{ViewHelper} wird mit einem Parameter aufgerufen. Dieser wird zuerst ausgewertet, um zu bestimmen, welche Elemente benötigt werden. Anschliesend werden im nächsten Schritt die entsprechenden Elemente gesucht. Als nächstes wird die Annotationen aus den geladenen HTML-Elementen entfernt. Zum Schluss werden alle geladenen Elemente anstelle des \textit{ViewHelpers} innerhalb des angeforderten HTML-Templates eingefügt.

TYPO3 besitzt sehr intelligente Caching-Mechanismen, die ein solches Vorgehen erlauben. Denn durch die Nutzung von Caches erstellt TYPO3 nicht bei jedem Seitenaufruf das Template neu.

\begin{figure}[!ht]
\centering
\includegraphics[width=12cm]{Bilder/nav_bar_login.png}
\caption{Navigationsleiste wenn ein Nutzer eingeloggt ist}
\label{userLogin}
\centering
\end{figure}

Ist der Nutzer eingeloggt, so ändern sich die Symbole in der Menüleiste auf der linken Seite (siehe Abbildung).

% TYPO3 unterstützt war "`Partials"', welche Teil-Templates innerhalb von Templates darstellen, diese können aber nicht dynamisch geladen werden.